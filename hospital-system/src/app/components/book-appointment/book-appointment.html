<div class="min-h-screen bg-gray-100 py-10 px-6">
  <div class="max-w-3xl mx-auto bg-white rounded-lg shadow-md p-8">
    <h2 class="text-2xl font-bold text-blue-900 mb-6 text-center">
      Book an Appointment
    </h2>

    
    <!-- Error or Success Message -->
    <div *ngIf="errorMessage" class="text-red-500 text-center mb-4">
      {{ errorMessage }}
    </div>
    <div *ngIf="successMessage" class="text-green-500 text-center mb-4">
      {{ successMessage }}
    </div>

    <!-- Patient Search Input -->
    <div class="mb-4">
      <h3 class="text-lg font-semibold text-gray-800">Search for a Patient:</h3>
      <input type="text" [(ngModel)]="patientSearchTerm" (input)="filterPatients()" placeholder="Search by name or Ghana Card number"
             class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-300 p-2"/>
    </div>

    <!-- Patient Dropdown -->
    <div class="mb-4">
      <h3 class="text-lg font-semibold text-gray-800">Select a Patient: <span [class.text-red-500]="!patient?.value" [class.text-green-500]="patient?.value">*</span></h3>
      <select #patient="ngModel" id="patient" name="patient" [(ngModel)]="patient.value" required
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-300 p-2">
        <option value="">-- Select Patient --</option>
        <option *ngFor="let patient of filteredPatients" [value]="patient.id">
          {{ patient.first_name }} {{ patient.last_name }} - {{ patient.ghana_card_number }}
        </option>
      </select>
    </div>

    <!-- Doctor Search Input -->
    <div class="mb-4">
      <h3 class="text-lg font-semibold text-gray-800">Search for a Doctor:</h3>
      <input type="text" [(ngModel)]="doctorSearchTerm" (input)="filterDoctors()" placeholder="Search by doctor's name"
             class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-300 p-2"/>
    </div>

    <!-- Doctor Dropdown -->
    <div class="mb-4">
      <h3 class="text-lg font-semibold text-gray-800">Select a Doctor: <span [class.text-red-500]="!doctor?.value" [class.text-green-500]="doctor?.value">*</span></h3>
      <select #doctor="ngModel" id="doctor" name="doctor" [(ngModel)]="doctor.value" required
              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-300 p-2">
        <option value="">-- Select Doctor --</option>
        <option *ngFor="let doctor of filteredDoctors" [value]="doctor.id">
          {{ doctor.first_name }} {{ doctor.last_name }}
        </option>
      </select>
    </div>

    <!-- Reason for Appointment -->
    <div class="mb-4">
      <h3 class="text-lg font-semibold text-gray-800">Reason for Appointment: <span [class.text-red-500]="!reason?.value" [class.text-green-500]="reason?.value">*</span></h3>
      <textarea #reason="ngModel" id="reason" name="reason" [(ngModel)]="reason.value" rows="4" placeholder="Describe symptoms or reason..."
                required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-300 p-2"></textarea>
    </div>

    <!-- Appointment Form -->
    <form (ngSubmit)="onSubmit()" class="space-y-6">
      <!-- Department -->
      <div>
        <label for="department" class="block text-sm font-medium text-gray-700">Department <span [class.text-red-500]="!department?.value" [class.text-green-500]="department?.value">*</span></label>
        <select #department="ngModel" id="department" name="department" [(ngModel)]="department.value" required
                class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-300 p-2">
          <option value="">-- Select Department --</option>
          <option>General Medicine</option>
          <option>Pediatrics</option>
          <option>Obstetrics & Gynecology</option>
          <option>Surgery</option>
          <option>Cardiology</option>
          <option>Dermatology</option>
          <option>ENT</option>
        </select>
      </div>

      <!-- Date & Time -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div>
          <label for="date" class="block text-sm font-medium text-gray-700">Preferred Date <span [class.text-red-500]="!date?.value" [class.text-green-500]="date?.value">*</span></label>
          <input #date="ngModel" type="date" id="date" name="date" [(ngModel)]="date.value" required
                 class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-300 p-2"/>
        </div>

        <div>
          <label for="time" class="block text-sm font-medium text-gray-700">Preferred Time <span [class.text-red-500]="!time?.value" [class.text-green-500]="time?.value">*</span></label>
          <input #time="ngModel" type="time" id="time" name="time" [(ngModel)]="time.value" required
                 class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-300 p-2"/>
        </div>
      </div>

     <!-- Submit -->
      <div class="text-center mt-6">
        <button type="submit"
                [disabled]="isLoading || !scheduleData.patientId || !scheduleData.doctorId || !scheduleData.department || !scheduleData.date || !scheduleData.time || !scheduleData.reason"
                class="flex items-center justify-center gap-2 px-6 py-2 bg-blue-900 text-white rounded-lg shadow hover:bg-blue-700 transition disabled:opacity-60 disabled:cursor-not-allowed">

          <!-- Spinner -->
          <svg *ngIf="isLoading" class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none"
              viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor"
                  d="M4 12a8 8 0 018-8v4l3-3-3-3v4a8 8 0 00-8 8h4z"></path>
          </svg>

          <!-- Button Label -->
          <span *ngIf="isLoading">Saving...</span>
          <span *ngIf="!isLoading">Book Appointment</span>
        </button>
      </div>

    </form>
  </div>
</div>
