<div *ngIf="isLoggedIn" class="flex justify-center items-center min-h-screen bg-gray-100">
  <div class="container mx-auto p-6 bg-white shadow-lg rounded-lg w-full sm:w-4/5 lg:w-1/2">
    <h2 class="text-2xl font-bold text-center mb-4">Prescribe Medicine</h2>

    <!-- Loading Spinner -->
    <div *ngIf="isLoading" class="flex justify-center mb-4">
      <div class="spinner-border animate-spin inline-block w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <!-- Success and Error Messages -->
    <div *ngIf="successMessage" class="text-green-500 text-center mb-4">
      {{ successMessage }}
    </div>
    <div *ngIf="errorMessage" class="text-red-500 text-center mb-4">
      {{ errorMessage }}
    </div>

    <!-- Search Patient -->
    <div class="mb-4">
      <label for="patientName" class="block text-gray-700">Search Patient by Name</label>
      <input id="patientName" [(ngModel)]="patientName" (input)="searchPatient()" placeholder="Enter patient name"
        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
    </div>

    <!-- Patient List (Filtered by Name) -->
    <div *ngIf="patients.length > 0" class="mb-4">
      <label for="patient" class="block text-gray-700">Select Patient</label>
      <select id="patient" [(ngModel)]="prescriptionData.patientId" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
        <option value="">Select patient</option>
        <option *ngFor="let patient of patients" [value]="patient.id">
          {{ patient.first_name }} {{ patient.last_name }}
        </option>
      </select>
    </div>

    <!-- Medicine Prescription -->
    <div class="mt-4 mb-4">
      <label for="medicine" class="block text-gray-700">Search and Select Medicine</label>
      <input type="text" [(ngModel)]="prescriptionData.medicine" (input)="filterMedicines()" placeholder="Search for a medicine"
        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
        <br>
      <select id="medicine" [(ngModel)]="prescriptionData.medicine" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
        <option value="">Select medicine</option>
        <option *ngFor="let medicine of filteredMedicines" [value]="medicine.name">
          {{ medicine.name }} (Stock: {{ medicine.stock_quantity }})
        </option>
      </select>
    </div>

    <!-- Dosage and Instructions -->
    <div class="mt-4 mb-4">
      <label for="dosage" class="block text-gray-700">Dosage</label>
      <input id="dosage" [(ngModel)]="prescriptionData.dosage" type="text" placeholder="Enter dosage"
        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none">
    </div>

    <div class="mt-4 mb-6">
      <label for="instructions" class="block text-gray-700">Instructions</label>
      <textarea id="instructions" [(ngModel)]="prescriptionData.instructions" rows="3" placeholder="Enter instructions"
        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none"></textarea>
    </div>

          <!-- Submit Button -->
      <div class="mt-6 text-center">
        <button (click)="prescribeMedicine()" 
                [disabled]="!prescriptionData.patientId || !prescriptionData.medicine || !prescriptionData.dosage"
                class="bg-blue-900 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center justify-center">
                
          <!-- SVG Spinner, visible when isLoading is true -->
          <svg *ngIf="isLoading" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-5 h-5 mr-2 animate-spin">
            <circle cx="12" cy="12" r="10" stroke="white" stroke-width="2" class="opacity-25"/>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 12a8 8 0 1 1 8 8 8 8 0 0 1-8-8z"/>
          </svg>

          <!-- Button Text -->
          <span *ngIf="!isLoading">Prescribe Medicine</span>
          <span *ngIf="isLoading">Loading...</span>
        </button>
      </div>

  </div>
</div>

<div *ngIf="!isLoggedIn" class="flex justify-center items-center min-h-screen bg-gray-100">
  <div class="container text-center">
    <p>Please log in as a doctor to prescribe medicine.</p>
  </div>
</div>
